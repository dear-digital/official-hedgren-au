{{ 'hedgren-product.css' | asset_url | stylesheet_tag }}

<div class="product-wrap">
  <div class="container">
    <div class="product-info-imgs flex-box justify-between">
      <div class="product-name-price-rating-wrap no-d">
        <div class="product-name-price-wrap flex-box justify-between">
      	<h1 class="product-title">{{ product.title | escape  }}</h1>
        <div class="product-price">{{ product.price | money  }}</div>
        </div>
        <div class="product-rating">
        	{% include 'icon-black-star' %}
          	{% include 'icon-black-star' %}
          	{% include 'icon-black-star' %}
          	{% include 'icon-black-star' %}
          	{% include 'icon-black-star' %}
          <span class="no-of-ratings">(521)</span>
        </div>
      </div>
      <div class="product-imgs flex-box no-t-m">
      	{% for media in product.media %}
        <div class="product-img">
        <img src="{{ media | img_url: 'x300' }}" alt="{{ media.alt | escape }}">
        </div>          
        {% endfor %}
        <div class="load-more-images">LOAD MORE IMAGES</div>
      </div>
      <div class="product-imgs-mobile no-d">
      	{% for media in product.media %}
        <div class="product-img-mob">
        <img src="{{ media | img_url: 'x300' }}" alt="{{ media.alt | escape }}">
        </div>          
        {% endfor %}
      </div>
      <div class="product-info">
      	<h1 class="product-title no-t-m">{{ product.title | escape  }}</h1>
        <div class="product-price no-t-m">{{ product.price | money  }}</div>
        <div class="product-rating no-t-m">
          {%for i in (1..product.metafields.loox.avg_rating) %}
        	{% include 'icon-black-star' %}
          {% endfor %}
          <span class="no-of-ratings">({{ product.metafields.loox.num_reviews }})</span>
        </div>
        <div class="color-variant-wrap">
          <div class="variant-title">COLOUR</div>
          <div class="variants flex-box">
            {% include 'color-product-swatch' %}
            {% include 'color-product-swatch-2' %}
          </div>
        </div>
        <div class="add-to-cart" data-variant="{{ product.selected_or_first_available_variant.id }}">{% if product.available %}ADD TO CART{% else %}Sold Out{% endif %} {% include 'icon-plus-black' %}</div>
        <div class="product-desc">{% if product.description contains '<!-- split -->' %}{% assign desc = product.description | split: '<!-- split -->' %}{{ desc[1] }}{% else %}{{ product.description }}{% endif %}</div>
        <div class="product-usps">
          {% if product.description contains '<!-- split -->' %}
          {% assign row = product.description | split: '<!-- split -->' %}
          {% assign size = row.size | plus:0 | minus: 1 %}

          {% for i in (1..size) %}
          {% if forloop.index > 1 %}
          {% assign aux = i | plus: 1 %}
          {% assign mod = aux | modulo: 2 %}

          {% if mod == 1 %}
          <div class="product-ups-wrap">
            <div class="product-usp-title accordion flex-box justify-between">{{row[i]}}<span class="down-chev">{% include 'icon-down-chev-red' %}</span></div>
            {% else %}
            <div class="product-usp-content panel">{{row[i]}}</div>
          </div>
          {% endif %}
          {% endif %}
          {% endfor %}

          {% endif %}
          {% comment %}
          <div class="product-ups-wrap">
            <div class="product-usp-title accordion flex-box justify-between">FEATURES<span class="down-chev">{% include 'icon-down-chev-red' %}</span></div>
            <div class="product-usp-content panel">
              <div class="product-usp-features flex-box justify-between">
            	{% for i in (1..12) %}
                <div class="usp-feature flex-box{% if forloop.first == true %} selected{% endif %}" data-id="{{ forloop.index }}">
                <div class="feature-circle"></div>
                  <div class="feature-title">Feature</div>
                </div>
              	{% endfor %}
              </div>
              <div class="feature-text" data-id="1">
                 1 Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna a
                </div>
              <div class="feature-text no-disp" data-id="2">
                 2 Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna a
                </div>
              <div class="feature-text no-disp" data-id="3">
                 3 Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna a
                </div>
              <div class="feature-text no-disp" data-id="4">
                 4 Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna a
                </div>
              <div class="feature-text no-disp" data-id="5">
                 5 Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna a
                </div>
            </div>
          </div>
          {% endcomment %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  
  var numItems = $('.product-img').length;
  if(numItems<5){
  	$('.load-more-images').addClass('no-disp');
  }
  
  $(".product-img").hide();
 $(".product-img:lt(4)").show();
  
  $('.load-more-images').click(function() {
  	$(".product-img").show();
    $(this).addClass('no-disp');
  });
  
  
  $('.variant-color').click(function() {
  	$('.variant-color').removeClass('selected');
    $(this).addClass('selected');
  });
  
  $('.usp-feature').click(function() {
  	$('.usp-feature').removeClass('selected');
    $(this).addClass('selected');
    var fet_id = $(this).data('id');
    $('.feature-text').addClass('no-disp');
    $('.feature-text').each(function() {
    	var txt_id = $(this).data('id');
      if(txt_id == fet_id)
      {
      	$(this).removeClass('no-disp');
      }
    });
  });
  
  $('.add-to-cart').click(function() {
    var formData = {
      'items': [{
        'id': parseInt($(this).data('variant')),
        'quantity': 1
      }]
    };
    $.ajax({
      url: "/cart/add.js",
      method: "POST",
      dataType: "json",
      data: formData,
    })
    .done(function( data ) {     
      $.ajax({
        url: '/?sections=hedgren-cart-drawer',
        method: "GET",
        dataType: "json"
      })
      .done(function( data ) {
        $('#shopify-section-hedgren-cart-drawer').remove();
        $(data["hedgren-cart-drawer"]).insertAfter("#shopify-section-hedgren-header");
        $('.drawer-cart').addClass('drawn');
        $('body').addClass('no-scroll');
      })
      .fail(function(error) {
        console.log( error );
      });
    })
    .fail(function(error) {
      console.log( error );
    });
  });
  
  $('.variant-color-wrapper').click(function() {
    var url = $(this).data('url');
    if($(this).find('img').hasClass('hedgren-color-inactive')) {
      $.ajax({
        url: $(this).data('url')+'/?sections=hedgren-product',
        method: "GET"
      })
      .done(function( data ) {
        $('main').prepend(data['hedgren-product']);
        var acc = document.getElementsByClassName("product-usp-title");
        var i;

        for (i = 0; i < acc.length; i++) {
          acc[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
              panel.style.maxHeight = null;
            } else {
              panel.style.maxHeight = panel.scrollHeight + "px";
            } 
          });
        }
        window.history.pushState({}, null, url);
        $('.product-imgs-mobile')[0].slick.refresh();
        $('.product-wrap').last().parent().remove();
      })
      .fail(function(error) {
        console.log( error );
      });
    }
  });

   
</script>

{% schema %}
  {
    "name": "Hedgren Product",
    "settings": [],
	"presets": [
		{
			"name": "Hedgren Product"
		}
	]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
